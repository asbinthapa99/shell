name: Auto Commit

on:
  schedule:
    # Runs every 11 hours (matches the LaunchDaemon interval)
    - cron: '0 */11 * * *'
  workflow_dispatch: # Allow manual trigger

permissions:
  contents: write

jobs:
  auto-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure git
        run: |
          git config user.name "AutoCommit Bot"
          git config user.email "autocommit@bot.local"

      - name: Increment day counter and update README
        run: |
          if [ -f day_count.txt ]; then
            DAY=$(cat day_count.txt)
            DAY=$((DAY + 1))
          else
            DAY=1
          fi

          echo $DAY > day_count.txt

          TODAY=$(date '+%Y-%m-%d %H:%M:%S')
          echo "Day $DAY - $TODAY" >> README.md

          echo "DAY=$DAY" >> "$GITHUB_ENV"
          echo "TODAY=$TODAY" >> "$GITHUB_ENV"

      - name: Commit and push
        run: |
          git add day_count.txt README.md
          git diff --staged --quiet || git commit -m "auto-commit: Day $DAY at $TODAY"
          git push
